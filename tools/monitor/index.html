<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Monitor Dashboard</title>
    <script src="echarts.min.js"></script>
</head>
<body>

<div id="chart_mysql_pool" style="width: 700px;height:400px;float: left;"></div>
<div id="chart_memory" style="width: 700px;height:400px;float: left;"></div>
<div id="chart_coroutine" style="width: 700px;height:400px;float: left;"></div>
<div id="chart_idle_worker" style="width: 700px;height:400px;float: left;"></div>
<div id="chart_connection" style="width: 700px;height:400px;float: left;"></div>
<div id="chart_object_pool" style="width: 700px;height:400px;float: left;"></div>

<script>
    var serverAddr = "http://127.0.0.1:9501";

    function sampleData() {
        fetch(serverAddr+'/internal/monitor/pool')
            .then(function (response) {
                return response.json();
            })
            .then(function (myJson) {
                var mysqlPoolCount = myJson.mysql;
                if (mysqlPoolCount == null) {
                    mysqlPoolCount = 0;
                }

                var now = new Date();

                var currentMysqlPoolData = {
                    value: [
                        now.getFullYear() + '-' + now.getMonth() + '-' + now.getDate() + ' ' +
                        now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds(),
                        mysqlPoolCount
                    ]
                };

                mysqlPoolData.push(currentMysqlPoolData);
                if (mysqlPoolData.length > 5) {
                    mysqlPoolData.shift();
                }

                chartMysqlPool.setOption({
                    series: [{
                        data: mysqlPoolData
                    }]
                });

                var currentObjectPoolData = {
                    value: [
                        now.getFullYear() + '-' + now.getMonth() + '-' + now.getDate() + ' ' +
                        now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds(),
                        myJson.object.total
                    ]
                };

                objectPoolData.push(currentObjectPoolData);
                if (objectPoolData.length > 5) {
                    objectPoolData.shift();
                }

                chartObjectPool.setOption({
                    series: [{
                        data: objectPoolData
                    }]
                });
            });

        fetch(serverAddr+'/internal/monitor/memory')
            .then(function (response) {
                return response.json();
            })
            .then(function (myJson) {
                var now = new Date();
                var currentData = {
                    value: [
                        now.getFullYear() + '-' + now.getMonth() + '-' + now.getDate() + ' ' +
                        now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds(),
                        myJson.usage
                    ]
                };

                memoryData.push(currentData);
                if (memoryData.length > 5) {
                    memoryData.shift();
                }

                chartMemory.setOption({
                    series: [{
                        data: memoryData
                    }]
                });
            });

        fetch(serverAddr+'/internal/monitor/swoole')
            .then(function (response) {
                return response.json();
            })
            .then(function (myJson) {
                var now = new Date();

                var currentCoroutineData = {
                    value: [
                        now.getFullYear() + '-' + now.getMonth() + '-' + now.getDate() + ' ' +
                        now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds(),
                        myJson.coroutine.coroutine_num
                    ]
                };

                coroutineData.push(currentCoroutineData);
                if (coroutineData.length > 5) {
                    coroutineData.shift();
                }

                chartCoroutine.setOption({
                    series: [{
                        data: coroutineData
                    }]
                });

                var currentIdleWorkerData = {
                    value: [
                        now.getFullYear() + '-' + now.getMonth() + '-' + now.getDate() + ' ' +
                        now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds(),
                        myJson.swoole.idle_worker_num
                    ]
                };

                idleWorkerData.push(currentIdleWorkerData);
                if (idleWorkerData.length > 5) {
                    idleWorkerData.shift();
                }

                chartIdleWorker.setOption({
                    series: [{
                        data: idleWorkerData
                    }]
                });

                var currentConnectionData = {
                    value: [
                        now.getFullYear() + '-' + now.getMonth() + '-' + now.getDate() + ' ' +
                        now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds(),
                        myJson.swoole.connection_num
                    ]
                };

                connectionData.push(currentConnectionData);
                if (connectionData.length > 5) {
                    connectionData.shift();
                }

                chartConnection.setOption({
                    series: [{
                        data: connectionData
                    }]
                });
            });
    }

    var mysqlPoolData = [];
    var memoryData = [];
    var coroutineData = [];
    var idleWorkerData = [];
    var connectionData = [];
    var objectPoolData = [];

    var chartMysqlPoolOption = {
        title: {
            text: 'MySQL Pool'
        },
        tooltip: {
            trigger: 'axis',
            formatter: function (params) {
                params = params[0];
                return params.value[1];
            },
            axisPointer: {
                animation: false
            }
        },
        xAxis: {
            type: 'time',
            splitLine: {
                show: true
            }
        },
        yAxis: {
            type: 'value',
            boundaryGap: [0, '100%'],
            splitLine: {
                show: true
            }
        },
        series: [{
            name: 'MySQL Pool Data',
            type: 'line',
            showSymbol: false,
            hoverAnimation: false,
            data: mysqlPoolData
        }]
    };

    var chartMemoryOption = {
        title: {
            text: 'Memory'
        },
        tooltip: {
            trigger: 'axis',
            formatter: function (params) {
                params = params[0];
                return params.value[1];
            },
            axisPointer: {
                animation: false
            }
        },
        xAxis: {
            type: 'time',
            splitLine: {
                show: true
            }
        },
        yAxis: {
            type: 'value',
            boundaryGap: [0, '100%'],
            splitLine: {
                show: true
            }
        },
        series: [{
            name: 'Memory Data',
            type: 'line',
            showSymbol: false,
            hoverAnimation: false,
            data: memoryData
        }]
    };

    var chartCoroutineOption = {
        title: {
            text: 'Coroutine'
        },
        tooltip: {
            trigger: 'axis',
            formatter: function (params) {
                params = params[0];
                return params.value[1];
            },
            axisPointer: {
                animation: false
            }
        },
        xAxis: {
            type: 'time',
            splitLine: {
                show: true
            }
        },
        yAxis: {
            type: 'value',
            boundaryGap: [0, '100%'],
            splitLine: {
                show: true
            }
        },
        series: [{
            name: 'Coroutine Data',
            type: 'line',
            showSymbol: false,
            hoverAnimation: false,
            data: coroutineData
        }]
    };

    var chartIdleWorkerOption = {
        title: {
            text: 'Idle Worker'
        },
        tooltip: {
            trigger: 'axis',
            formatter: function (params) {
                params = params[0];
                return params.value[1];
            },
            axisPointer: {
                animation: false
            }
        },
        xAxis: {
            type: 'time',
            splitLine: {
                show: true
            }
        },
        yAxis: {
            type: 'value',
            boundaryGap: [0, '100%'],
            splitLine: {
                show: true
            }
        },
        series: [{
            name: 'Idle Worker Data',
            type: 'line',
            showSymbol: false,
            hoverAnimation: false,
            data: idleWorkerData
        }]
    };

    var chartConnectionOption = {
        title: {
            text: 'Connection'
        },
        tooltip: {
            trigger: 'axis',
            formatter: function (params) {
                params = params[0];
                return params.value[1];
            },
            axisPointer: {
                animation: false
            }
        },
        xAxis: {
            type: 'time',
            splitLine: {
                show: true
            }
        },
        yAxis: {
            type: 'value',
            boundaryGap: [0, '100%'],
            splitLine: {
                show: true
            }
        },
        series: [{
            name: 'Connection Data',
            type: 'line',
            showSymbol: false,
            hoverAnimation: false,
            data: connectionData
        }]
    };

    var chartObjectPoolOption = {
        title: {
            text: 'Object Pool'
        },
        tooltip: {
            trigger: 'axis',
            formatter: function (params) {
                params = params[0];
                return params.value[1];
            },
            axisPointer: {
                animation: false
            }
        },
        xAxis: {
            type: 'time',
            splitLine: {
                show: true
            }
        },
        yAxis: {
            type: 'value',
            boundaryGap: [0, '100%'],
            splitLine: {
                show: true
            }
        },
        series: [{
            name: 'Object Pool Data',
            type: 'line',
            showSymbol: false,
            hoverAnimation: false,
            data: objectPoolData
        }]
    };

    var chartMysqlPool = echarts.init(document.getElementById('chart_mysql_pool'));
    chartMysqlPool.setOption(chartMysqlPoolOption);

    var chartMemory = echarts.init(document.getElementById('chart_memory'));
    chartMemory.setOption(chartMemoryOption);

    var chartCoroutine = echarts.init(document.getElementById('chart_coroutine'));
    chartCoroutine.setOption(chartCoroutineOption);

    var chartIdleWorker = echarts.init(document.getElementById('chart_idle_worker'));
    chartIdleWorker.setOption(chartIdleWorkerOption);

    var chartConnection = echarts.init(document.getElementById('chart_connection'));
    chartConnection.setOption(chartConnectionOption);

    var chartObjectPool = echarts.init(document.getElementById('chart_object_pool'));
    chartObjectPool.setOption(chartObjectPoolOption);

    setInterval(function () {
        sampleData();
    }, 1000);
</script>
</body>
</html>